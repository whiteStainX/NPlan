# NPlan PRD: The Self-Correcting Training System

## 1. Product Vision
The name NPlan suggests a NP Complete problem. The core prbolem that this app trying to solve is to generate a scientific gym plan, with many rules and constraints applied, the plan is not easy (in theory) to achieve the ideal situation. We introduce an algorithm to reduce the complexity of the problem and leave user the final decision to adjust and make the plan work. 

It requires certain level of understanding of weight training from the user to maximise the effect, or the user can just follow.

Key feature: generate a plan that can self correct and adapt.

**Core Philosophy:** "Rigid Strategy, Flexible Tactics."
*   **Strategy (The Plan):** A scientifically sound, periodized structure that guides long-term progress.
*   **Tactics (The Execution):** A flexible day-to-day interface that handles missed workouts, fatigue, and schedule changes without breaking the macro plan.

## 2. Target Audience
*   **Intermediate to Advanced Lifters:** People who need structure (periodization) but also need flexibility.
*   **Data-Driven Trainees:** Users who care about RPE, e1RM, and volume metrics.

## 3. Functional Requirements

### A. Onboarding & Profiling (The Foundation)
*   **Goal Selection:** Strength (Powerlifting focus) vs. Hypertrophy (Bodybuilding focus).
*   **Training Age:**
    *   *Novice:* Linear progression.
    *   *Intermediate:* Wave loading / Linear periodization.
    *   *Advanced:* Block periodization (Accumulation/Intensification).
*   **Constraints:** Days per week available.
*   **Output:** A specific `Plan` generated by the Engine. Which includes the first week of detailed plan as the base plan and the following plan calculated based on the periodization method.

### B. The Plan Generation Engine (The Brain, and the Hard Part)
*   **One Plan at a Time:** Only one active plan at a time for a user (offline first, so one user only)
*   **First Week As the Base:** Based on the cosntriats and input from user, the system generate a detailed workout plan for first week, including editable details (day of workout, exercises, sequence, number of sets).
*   **Determine the Period:** Suggest period to achieve certain goal, and allow user to adjust.  
*   **Dynamic Progression:** Based on the theory (user profile, target) to calculate the projected workout within the targeted period, and adjust (self-correction) along the workout, based on user assessment and performance/progression.

### C. The Calendar & Execution (The Interface)
*   **Calendar View:** The primary way to view the plan. Shows current month, past and planed workout, whether there are any missed workouts.
*   **Session Overrides:** Users can modify any future sessions.
    *   *Move:* Drag a session to another day.
    *   *Swap:* Replace an exercise (e.g., "Gym is busy, swap Bench for Dumbbell Press").
*   **Workout Mode:**
    *   RPE-based logging (Load, Reps, RPE).
    *   Rest timer (auto-set based on lift type, but adjustable, and also can skip).
    *   "Short on Time" toggle (APS - Antagonist Paired Sets).
    *   During workout, user is able to add or remove exercise, arrange the sequence, swap the current exercise to similar one, add or delete sets.
    *   User is able to end or cancel workout

### D. Analytics (The Feedback)
*   **Adherence:** Visual tracking of plan compliance. A simple current week view (a more focus verion of the calender to be displaed at the dashboard page)
*   **Volume Equator:** "Sets per Muscle Group" vs. targets (10-20 sets).
*   **Progression:** e1RM trends over time. 
*   **Actual VS Plan:** volume actual execution vs the planed volume

## 4. Technical Constraints & Standards
*   **Persistence:** SwiftData, one table to store user profile, another to store the plan and execution (within one table for easier query and make comparison)
*   **Offline First:** All logic runs locally.
*   **Source of Truth:** `WorkoutLog` (History) and `PlanTemplate` (Strategy) are the only truths. Future days are *Projections*.
